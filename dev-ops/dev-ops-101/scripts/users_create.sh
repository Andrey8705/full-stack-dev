#!/bin/bash

# Проверка на root-права
if [ "$EUID" -ne 0 ]; then
    echo "Пожалуйста, запустите скрипт с правами суперпользователя (sudo)"
    exit 1
fi

# Запрос имени нового пользователя
read -p "Введите имя нового пользователя: " username

# Проверка, не существует ли уже пользователь с таким именем
if id "$username" &>/dev/null; then
    echo "Пользователь '$username' уже существует. Пожалуйста, выберите другое имя."
    exit 1
fi

# Вопрос о создании новой группы или добавлении в существующую
read -p "Вы хотите создать новую группу для пользователя? (y/n): " create_group

if [[ "$create_group" == "y" || "$create_group" == "Y" ]]; then
    # Запрос имени новой группы
    read -p "Введите имя новой группы: " groupname

    # Проверка, существует ли уже группа с таким именем
    if getent group "$groupname" &>/dev/null; then
        echo "Группа '$groupname' уже существует. Пожалуйста, выберите другое имя для группы."
        exit 1
    fi

    # Создание новой группы
    groupadd "$groupname"
    echo "Группа '$groupname' успешно создана."

    # Создание пользователя с новой группой
    useradd -m -g "$groupname" "$username"
    echo "Пользователь '$username' создан и добавлен в группу '$groupname'."
else
    # Список существующих групп
    echo "Существующие группы:"
    cut -d: -f1 /etc/group

    # Запрос имени существующей группы
    read -p "Введите имя существующей группы для добавления пользователя: " groupname

    # Проверка, существует ли указанная группа
    if ! getent group "$groupname" &>/dev/null; then
        echo "Группа '$groupname' не существует. Пожалуйста, проверьте правильность имени."
        exit 1
    fi

    # Создание пользователя и добавление его в существующую группу
    useradd -m -g "$groupname" "$username"
    echo "Пользователь '$username' создан и добавлен в существующую группу '$groupname'."
fi

# Установка пароля для нового пользователя
passwd "$username"
echo "Пароль для пользователя '$username' успешно установлен."

